var K=Object.defineProperty;var k=n=>{throw TypeError(n)};var q=(n,t,e)=>t in n?K(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>q(n,typeof t!="symbol"?t+"":t,e),A=(n,t,e)=>t.has(n)||k("Cannot "+e);var d=(n,t,e)=>(A(n,t,"read from private field"),e?e.call(n):t.get(n)),w=(n,t,e)=>t.has(n)?k("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),_=(n,t,e,s)=>(A(n,t,"write to private field"),s?s.call(n,e):t.set(n,e),e);import{O as m,T as p,V as O,M as W,G as Y,d as v,c as R,o as X,a as g,b as y,_ as M,e as H,f as l,g as E,t as z,u as j,h as x,i as U,j as Z,L as J,p as Q,k as tt,l as S}from"./index-CnVnlULI.js";var b=(n=>(n.F32="f32",n.U32="u32",n.VEC4F="vec4f",n.VEC4U="vec4u",n))(b||{});function N(n){switch(n){case"f32":case"u32":return 1;case"vec4f":case"vec4u":return 4}}var c;class et{constructor(t,e){a(this,"type");w(this,c);a(this,"is_dirty");a(this,"size_components");a(this,"size_bytes");if(this.type=t,this.size_components=N(t),this.size_bytes=this.size_components*4,e.length!==this.size_components)throw new Error(`Uniform: expected ${this.size_components}, got ${e.length}`);_(this,c,new Uint32Array(e.buffer)),this.is_dirty=!0}get value(){return d(this,c)}set value(t){const e=new Uint32Array(t.buffer);if(e.length!==this.size_components)throw new Error(`value must be an array of length ${this.size_components}`);let s=!1;for(let i=0;i<e.length;i++)if(e[i]!==d(this,c)[i]){s=!0;break}s&&(this.is_dirty=!0,_(this,c,e))}}c=new WeakMap;var u;class B{constructor(t,e,s){a(this,"type");a(this,"size_components");a(this,"size_bytes");w(this,u);a(this,"is_dirty");this.type=t;const i=N(t);if(this.size_components=e*i,this.size_bytes=this.size_components*4,i%4!==0)throw new Error("Array values must be a multiple of 4 components");if(s.length!==this.size_components)throw new Error(`Array must have length ${this.size_components} got ${s.length}`);_(this,u,new Uint32Array(s.buffer)),this.is_dirty=!0}get value(){return d(this,u)}set value(t){const e=new Uint32Array(t.buffer);if(e.length!==this.size_components)throw new Error(`value must be an array of length ${this.size_components}`);let s=!1;for(let i=0;i<e.length;i++)if(e[i]!==d(this,u)[i]){s=!0;break}s&&(this.is_dirty=!0,_(this,u,e))}}u=new WeakMap;class V{constructor(t,e){a(this,"binding");a(this,"member_names");a(this,"member_map");a(this,"buffer");a(this,"size_components");a(this,"size_bytes");a(this,"values");this.binding=t,this.member_names=e.map(s=>s.name),this.member_map={};for(const s of e)this.member_map[s.name]=s.value;this.size_components=e.map(s=>s.value.size_components).reduce((s,i)=>s+i,0),this.size_bytes=this.size_components*4,this.values=new Uint32Array(this.size_components)}create(t){if(this.buffer)throw new Error("uniform buffer already exists!");this.buffer=t.createBuffer({size:this.size_bytes,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!1}),this.update_buffer(t)}update_buffer(t){if(!this.buffer)throw new Error("Buffer hasn't been created yet!");if(!Object.values(this.member_map).some(i=>i.is_dirty))return;let s=0;for(let i=0;i<this.member_names.length;i++){const o=this.member_names[i],r=this.member_map[o];r.is_dirty&&(this.values.set(r.value,s),r.is_dirty=!1),s+=r.size_components}t.queue.writeBuffer(this.buffer,0,this.values)}get layout_entry(){return{binding:this.binding,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}}get bind_group_entry(){if(!this.buffer)throw new Error("buffer not ready yet!");return{binding:this.binding,resource:{buffer:this.buffer}}}get_uniform(t){return this.member_map[t]}update(t){this.update_buffer(t)}}const C=["ArrowLeft","ArrowRight","ArrowDown","ArrowUp"];class st{constructor(){a(this,"keysPressed");this.keysPressed=new Map}init(){window.addEventListener("keydown",t=>{this.keysPressed.set(t.code,!0),C.includes(t.code)&&t.preventDefault()}),window.addEventListener("keyup",t=>{this.keysPressed.set(t.code,!1),C.includes(t.code)&&t.preventDefault()})}digital_key(t){return new m(()=>this.keysPressed.get(t)??!1)}get arrow_axes(){return[new p(this.digital_key("ArrowLeft"),this.digital_key("ArrowRight")),new p(this.digital_key("ArrowDown"),this.digital_key("ArrowUp"))]}get wasd_axes(){return[new p(this.digital_key("KeyA"),this.digital_key("KeyD")),new p(this.digital_key("KeyS"),this.digital_key("KeyW"))]}}function nt(n){const t=s=>{s.target===n&&s.preventDefault()},e={passive:!1};document.body.addEventListener("touchstart",t,e),document.body.addEventListener("touchend",t,e),document.body.addEventListener("touchmove",t,e)}function f(n,t,e){const s=n.getBoundingClientRect(),i=t-s.left,o=e-s.top;return new O(i,o)}function L(n,t,e){return Math.min(Math.max(n,t),e)}function G(n,t,e,s){return n>=0&&n<e&&t>=0&&t<s}const I=.1;class it{constructor(t){a(this,"pressed");a(this,"position");a(this,"canvas");this.pressed=!1,this.position=new O(0,0),this.canvas=t}init(){nt(this.canvas),this.canvas.addEventListener("pointerdown",t=>{this.pressed=!0,this.position=f(this.canvas,t.clientX,t.clientY)}),this.canvas.addEventListener("pointermove",t=>{this.position=f(this.canvas,t.clientX,t.clientY)}),this.canvas.addEventListener("pointerleave",t=>{this.position=f(this.canvas,t.clientX,t.clientY)}),this.canvas.addEventListener("pointerup",t=>{this.pressed=!1,this.position=f(this.canvas,t.clientX,t.clientY)})}get pressed_signal(){return new m(()=>this.pressed)}get screen_axes(){const t=new m(()=>{const{width:s,height:i}=this.canvas.getBoundingClientRect(),o=s/2,r=s/2;if(!G(this.position.x,this.position.y,s,i))return 0;const h=(this.position.x-o)/r;return Math.abs(h)<I?0:L(h,-1,1)}),e=new m(()=>{const{width:s,height:i}=this.canvas.getBoundingClientRect(),o=i/2;if(!G(this.position.x,this.position.y,s,i))return 0;const r=s/2,h=(this.position.y-o)/r;return Math.abs(h)<I?0:-L(h,-1,1)});return[t,e]}}const F=2,P=F*4,T=4,D=T*4;function at(n,t,e){return n&~(1<<t)|Number(e)<<t}class rt{constructor(t){a(this,"midi");a(this,"gamepad");a(this,"keyboard");a(this,"pointer");a(this,"u_input");a(this,"digital_signals",[]);a(this,"analog_signals",[]);this.midi=new W,this.gamepad=new Y,this.keyboard=new st,this.pointer=new it(t);const e=new B(b.VEC4U,F,new Uint32Array(P)),s=new B(b.VEC4F,T,new Float32Array(D));this.u_input=new V(1,[{name:"digital",value:e},{name:"analog",value:s}])}init(){this.midi.init(),this.gamepad.init(),this.keyboard.init(),this.pointer.init()}update_digital(t){const e=new Uint32Array(P);for(let s=0;s<this.digital_signals.length;s++){const i=this.digital_signals[s];i.update(t);const o=s&31,r=s>>5;e[r]=at(e[r],o,i.value)}this.u_input.get_uniform("digital").value=e}update_analog(t){const e=new Float32Array(D);for(let s=0;s<this.analog_signals.length;s++){const i=this.analog_signals[s];i.update(t),e[s]=i.value}this.u_input.get_uniform("analog").value=e}update(t,e){this.gamepad.update(),this.update_digital(e),this.update_analog(e),this.u_input.update(t)}create_resources(t){this.u_input.create(t)}configure_uniforms(t){t.digital&&this.digital_signals.push(...t.digital),t.analog&&this.analog_signals.push(...t.analog)}}class ot{constructor(t,e){a(this,"label");a(this,"entries");a(this,"layout");a(this,"bind_group");this.label=t,this.entries=e}create(t){this.layout=t.createBindGroupLayout({label:this.label,entries:this.entries.map(e=>e.layout_entry)}),this.bind_group=t.createBindGroup({label:this.label,layout:this.layout,entries:this.entries.map(e=>e.bind_group_entry)})}attach(t,e){if(!this.bind_group)throw new Error("Bind group not ready!");e.setBindGroup(t,this.bind_group)}}async function ct(){var t;const n=await((t=navigator.gpu)==null?void 0:t.requestAdapter());if(!n)throw new Error("WebGPU not supported ðŸ˜¢");return await n.requestDevice()}function ut(n){const t=document.getElementById(n);if(!t)throw new Error(`could not find canvas #${n}`);return t}function ht(n){const t=n.getContext("webgpu");if(!t)throw new Error("Could not get WebGPU context ðŸ˜¢");return t}class dt{constructor(t){a(this,"input");a(this,"machine");a(this,"u_frame");a(this,"bind_group");a(this,"canvas");this.canvas=ut("webgpu-canvas"),this.input=new rt(this.canvas),this.machine=t;const e=new et(b.F32,new Float32Array([0]));this.u_frame=new V(0,[{name:"time",value:e}]),this.bind_group=new ot("per_frame",[this.u_frame,this.input.u_input])}async main(){this.input.init();const t=await ct(),e=ht(this.canvas);await this.create_resources(t,e),this.configure_input();const s=performance.now(),i=()=>{const o=(performance.now()-s)/1e3;this.update(t,o);const r=t.createCommandEncoder();this.configure_passes(r,e),t.queue.submit([r.finish()]),requestAnimationFrame(i)};requestAnimationFrame(i)}async create_resources(t,e){this.u_frame.create(t),this.input.create_resources(t),this.bind_group.create(t),await this.machine.create_resources(t,this.canvas,e,this.bind_group)}configure_input(){this.machine.configure_input(this.input)}update(t,e){this.input.update(t,e),this.u_frame.get_uniform("time").value=new Float32Array([e]),this.u_frame.update(t),this.machine.update(e)}configure_passes(t,e){this.machine.configure_passes(t,e,this.bind_group)}}const _t={id:"webgpu-canvas",width:"500",height:"700"},lt=v({__name:"WebGPUSketch",props:{sketch_metadata:{}},setup(n){const t=n,e=R(()=>{const s=t.sketch_metadata.make_machine();return new dt(s)});return X(()=>{e.value.main()}),(s,i)=>(y(),g("canvas",_t))}}),pt=M(lt,[["__scopeId","data-v-21e10e8f"]]);function ft(n,t){const e=n.toDataURL(),s=document.createElement("a");s.href=e,s.download=t,document.body.appendChild(s),s.click(),s.remove()}const mt=v({__name:"ScreenshotButton",setup(n){function t(){const e=document.getElementById("webgpu-canvas");e&&ft(e,"screenshot.png")}return(e,s)=>(y(),g("button",{onClick:t},"Screenshot"))}}),$=n=>(Q("data-v-0e54f2b9"),n=n(),tt(),n),gt={key:0,class:"one-column vertical"},yt={key:0},bt=$(()=>l("div",{class:"break"},null,-1)),wt=$(()=>l("div",{class:"break"},null,-1)),vt={class:"description"},kt=["innerHTML"],At=v({__name:"SketchView",setup(n){const t=Z(),e=R(()=>{const s=t.params.sketch_id,i=Array.isArray(s)?s[0]:s;return S(i)});return H(s=>{const i=s.params.sketch_id,o=Array.isArray(i)?i[0]:i;return S(o)?s:{path:"/404"}}),(s,i)=>e.value?(y(),g("div",gt,[l("h1",null,[E(z(e.value.title)+" ",1),j(J).includes(e.value)?(y(),g("span",yt,"ðŸ§ª")):x("",!0),E(" ("+z(e.value.years)+")",1)]),U(pt,{sketch_metadata:e.value},null,8,["sketch_metadata"]),bt,U(mt),wt,l("div",vt,[l("div",{innerHTML:e.value.description},null,8,kt)])])):x("",!0)}}),xt=M(At,[["__scopeId","data-v-0e54f2b9"]]);export{xt as default};
